geom_sf(data = wildfire_c, fill = NA, color = "red") +
annotation_scale(location = "tr", width_hint = 0.25) +
xlim(-119.8, -118.8) + ylim(34.05, 34.85) +
theme_void() +
theme(legend.position = "none",
panel.background = element_rect(fill = "white"))
ggsave(filename = "figure_3c.png", plot = figure_3c, device = "png",
height = 6, width = 6, path = "output/figures/components/")
# Figure 3d ................................................................
# Simi Fire - CA - 2003 - CA3433511879220031025
figure_3d <- ggplot() +
geom_sf(data = wells_d_buffer, shape = 4, size = 2, color = "gray", alpha = 0.2) +
geom_sf(data = wildfire_d_buffer_1km, fill = "orange", color = NA, alpha = 0.3) +
geom_sf(data = wildfire_d, fill = "red", color = NA, alpha = 0.6) +
geom_sf(data = wells_d, shape = 4, size = 2, alpha = 0.2) +
geom_sf(data = wildfire_d, fill = NA, color = "red") +
annotation_scale(location = "tl", width_hint = 0.25) +
xlim(-119.2, -118.5) + ylim(34.05, 34.65) +
theme_void() +
theme(legend.position = "none",
panel.background = element_rect(fill = "white"))
ggsave(filename = "figure_3d.png", plot = figure_3d, device = "png",
height = 6, width = 6, path = "output/figures/components/")
source("../../code/0-setup/01-setup.R")
wildfires_wells_population %>%
filter(year %in% c(1984:2020)) %>%
group_by(year, state) %>%
summarize(n = n()) %>%
ggplot() +
geom_bar(aes(year, n), stat = "identity") +
labs(x = "Year", y = "Wildfires, n") +
facet_wrap(~ state) +
theme_classic()
wildfires_wells_population <-
readRDS("../../data/processed/wildfires_wells_population.rds")
wildfires_wells_population %>%
filter(year %in% c(1984:2020)) %>%
group_by(year, state) %>%
summarize(n = n()) %>%
ggplot() +
geom_bar(aes(year, n), stat = "identity") +
labs(x = "Year", y = "Wildfires, n") +
facet_wrap(~ state) +
theme_classic()
wildfires_wells_population %>%
filter(year %in% c(1984:2020)) %>%
filter(n_wells > 0) %>%
group_by(year, state) %>%
summarize(n = n()) %>%
ggplot() +
geom_bar(aes(year, n), stat = "identity") +
labs(x = "Year", y = "Wildfires, n") +
facet_wrap(~ state) +
theme_classic()
source("../../code/0-setup/01-setup.R")
wildfires_wells_population <-
readRDS("../../data/processed/wildfires_wells_population.rds")
wildfires_wells_population %>% arrange(desc(n_wells)) %>% select(-data_source)
wildfires_wells_population %>%
distinct(wildfire_id, .keep_all = TRUE) %>%
filter(year %in% c(1984:2020)) %>%
group_by(year) %>%
summarize(n = n()) %>%
ggplot() +
geom_bar(aes(year, n), stat = "identity") +
labs(x = "Year", y = "Wildfires, n") +
ylim(0, 3700) +
theme_classic()
wildfires_wells_population %>%
filter(year %in% c(1984:2020)) %>%
filter(n_wells > 0) %>%
group_by(year) %>%
summarize(n = n()) %>%
ggplot() +
geom_bar(aes(year, n), stat = "identity") +
labs(x = "Year", y = "Wildfires, n") +
ylim(0, 3700) +
theme_classic()
wildfires_wells_population %>%
filter(year %in% c(1984:2020)) %>%
group_by(year) %>%
summarize(n = sum(n_wells)) %>%
ggplot() +
geom_bar(aes(year, n), stat = "identity") +
labs(x = "Year", y = "Wells, n") +
theme_classic()
wildfires_wells_population %>%
filter(year %in% c(1984:2020)) %>%
group_by(year) %>%
summarize(n = sum(n_wells)) %>%
ggplot() +
#geom_bar(aes(year, n), stat = "identity") +
geom_point(aes(year, n)) +
geom_smooth(aes(year, n), method = lm, formula = "y ~ x") +
labs(x = "Year", y = "Wells, n") +
theme_classic()
wildfires_wells_population %>%
filter(year %in% c(1984:2020)) %>%
group_by(year, state) %>%
summarize(n = n()) %>%
ggplot() +
geom_bar(aes(year, n), stat = "identity") +
labs(x = "Year", y = "Wildfires, n") +
facet_wrap(~ state) +
theme_classic()
wildfires_wells_population %>%
filter(year %in% c(1984:2020)) %>%
filter(n_wells > 0) %>%
group_by(year, state) %>%
summarize(n = n()) %>%
ggplot() +
geom_bar(aes(year, n), stat = "identity") +
labs(x = "Year", y = "Wildfires, n") +
facet_wrap(~ state) +
theme_classic()
wildfires_wells_population %>%
filter(year %in% c(1984:2020)) %>%
group_by(year, state) %>%
summarize(n     = sum(n_wells)) %>%
ggplot() +
geom_bar(aes(year, n), stat = "identity") +
labs(x = "Year", y = "Wells, n") +
facet_wrap(. ~ state) +
theme_classic()
wildfires_wells_all_dates_1km %>%
arrange(desc(wells_all_dates_1km))
wildfires_wells_population %>%
arrange(desc(n_wells_buffer_1km))
wildfires_wells_population %>% group_by(wildfire_id) %>% summarize(wells_total = sum(n_wells)) %>% filter(wells_total > 0) %>% nrow
wildfires_wells_population %>% filter(n_wells > 0) %>% nrow
nrow(subset(wildfires_wells_population, n_wells > 0)) / nrow(wildfires_wells_population)
(100 * nrow(subset(wildfires_wells_population, n_wells > 0)) / nrow(wildfires_wells_population))
round((100 * nrow(subset(wildfires_wells_population, n_wells > 0)) / nrow(wildfires_wells_population)), digits = 2)
round((100 * nrow(subset(wildfires_wells_population, n_wells > 0)) / nrow(wildfires_wells_population)), digits = 3)
round((100 * nrow(subset(wildfires_wells_population, n_wells > 0)) / nrow(wildfires_wells_population)), digits = 2)
round((100 * nrow(subset(wildfires_wells_population, n_wells > 0)) / nrow(wildfires_wells_population)), digits = 3)
sum(wildfires_wells_population$n_wells)
wildfires_wells_population %>%
group_by(state) %>%
summarize(n_wells_by_state = sum(n_wells)) %>%
arrange(desc(n_wells_by_state))
wildfires_wells_population %>% filter(state == "OK") %>% View
wildfires_wells_population %>%
group_by(state) %>%
summarize(n_wells_by_state = sum(n_wells),
n_wells_buffer_1km_by_state = sum(n_wells_buffer_1km)) %>%
arrange(desc(n_wells_by_state))
wildfires_wells_population %>%
group_by(state) %>%
summarize(n_wells_by_state = sum(n_wells),
n_wells_buffer_1km_by_state = sum(n_wells_buffer_1km)) %>%
arrange(desc(n_wells_by_state))
source("../../code/0-setup/01-setup.R")
wildfires_wells_population <-
readRDS("../../data/processed/wildfires_wells_population.rds")
wildfires_wells_population %>% arrange(desc(n_wells)) %>% select(-data_source)
wildfires_wells_population %>%
distinct(wildfire_id, .keep_all = TRUE) %>%
filter(year %in% c(1984:2020)) %>%
group_by(year) %>%
summarize(n = n()) %>%
ggplot() +
geom_bar(aes(year, n), stat = "identity") +
labs(x = "Year", y = "Wildfires, n") +
ylim(0, 3700) +
theme_classic()
wildfires_wells_population %>%
filter(year %in% c(1984:2020)) %>%
filter(n_wells > 0) %>%
group_by(year) %>%
summarize(n = n()) %>%
ggplot() +
geom_bar(aes(year, n), stat = "identity") +
labs(x = "Year", y = "Wildfires, n") +
ylim(0, 3700) +
theme_classic()
wildfires_wells_population %>%
group_by(state) %>%
summarize(n_wells_by_state = sum(n_wells),
n_wells_buffer_1km_by_state = sum(n_wells_buffer_1km)) %>%
arrange(desc(n_wells_by_state))
wildfires_wells_population %>%
filter(year %in% c(1984:2020)) %>%
group_by(year) %>%
summarize(n = sum(n_wells)) %>%
ggplot() +
geom_bar(aes(year, n), stat = "identity") +
labs(x = "Year", y = "Wells, n") +
theme_classic()
wildfires_wells_population %>%
filter(year %in% c(1984:2020)) %>%
group_by(year) %>%
summarize(n = sum(n_wells)) %>%
ggplot() +
geom_point(aes(year, n)) +
geom_smooth(aes(year, n), method = lm, formula = "y ~ x") +
labs(x = "Year", y = "Wells, n") +
theme_classic()
wildfires_wells_population %>%
filter(year %in% c(1984:2020)) %>%
group_by(year, state) %>%
summarize(n = n()) %>%
ggplot() +
geom_bar(aes(year, n), stat = "identity") +
labs(x = "Year", y = "Wildfires, n") +
facet_wrap(~ state) +
theme_classic()
wildfires_wells_population %>%
filter(year %in% c(1984:2020)) %>%
filter(n_wells > 0) %>%
group_by(year, state) %>%
summarize(n = n()) %>%
ggplot() +
geom_bar(aes(year, n), stat = "identity") +
labs(x = "Year", y = "Wildfires, n") +
facet_wrap(~ state) +
theme_classic()
wildfires_wells_population %>%
filter(year %in% c(1984:2020)) %>%
group_by(year, state) %>%
summarize(n     = sum(n_wells)) %>%
ggplot() +
geom_bar(aes(year, n), stat = "identity") +
labs(x = "Year", y = "Wells, n") +
facet_wrap(. ~ state) +
theme_classic()
wildfires_wells_population %>%
arrange(desc(n_wells_buffer_1km))
wildfires_wells_population %>%
filter(year %in% c(1984:2020)) %>%
group_by(year) %>%
summarize(n = n()) %>%
ggplot() +
geom_bar(aes(year, n), stat = "identity") +
labs(x = "Year", y = "Wildfires, n") +
theme_classic()
wildfires_wells_population$n_wells_buffer_1km %>%
filter(year %in% c(1984:2020)) %>%
filter(n_wells_buffer_1km > 0) %>% nrow
wildfires_wells_population %>%
mutate(wildfire_burned_wells = case_when(n_wells >= 1 ~ 1,
n_wells == 0 ~ 0))
View(wildfires_wells_population)
wildfires_wells_population %>%
mutate(wildfire_burned_wells = case_when(n_wells >= 1 ~ 1,
n_wells == 0 ~ 0)) %>% View
wildfires_wells_population %>%
mutate(wildfire_burned_wells = case_when(n_wells >= 1 ~ 1,
n_wells == 0 ~ 0)) %>%
group_by(year) %>%
summarize(n_wildfires = n(),
n_wildfires_with_wells = sum(wildfire_burned_wells))
wildfires_wells_population %>%
mutate(wildfire_burned_wells = case_when(n_wells >= 1 ~ 1,
n_wells == 0 ~ 0)) %>%
group_by(year) %>%
summarize(n_wildfires = n(),
n_wildfires_with_wells = sum(wildfire_burned_wells)) %>%
mutate(perc_wildfires_with_wells =
round((100 * n_wildfires_with_wells / n_wildfires)), digits = 2)
wildfires_wells_population %>%
mutate(wildfire_burned_wells = case_when(n_wells >= 1 ~ 1,
n_wells == 0 ~ 0)) %>%
group_by(year) %>%
summarize(n_wildfires = n(),
n_wildfires_with_wells = sum(wildfire_burned_wells)) %>%
mutate(perc_wildfires_with_wells =
round((100 * n_wildfires_with_wells / n_wildfires), digits = 2))
wildfires_wells_population %>%
mutate(wildfire_burned_wells = case_when(n_wells >= 1 ~ 1,
n_wells == 0 ~ 0)) %>%
group_by(year) %>%
summarize(n_wildfires = n(),
n_wildfires_with_wells = sum(wildfire_burned_wells)) %>%
mutate(perc_wildfires_with_wells =
round((100 * n_wildfires_with_wells / n_wildfires), digits = 2)) %>%
ggplot() +
geom_point(aes(year, perc_wildfires_with_wells)) +
theme_classic()
wildfires_wells_population %>%
mutate(wildfire_burned_wells = case_when(n_wells >= 1 ~ 1,
n_wells == 0 ~ 0)) %>%
group_by(year) %>%
summarize(n_wildfires = n(),
n_wildfires_with_wells = sum(wildfire_burned_wells)) %>%
mutate(perc_wildfires_with_wells =
round((100 * n_wildfires_with_wells / n_wildfires), digits = 2)) %>%
ggplot(aes(year, perc_wildfires_with_wells)) +
geom_point() +
geom_smooth(method = lm, formula = "y ~ x") +
theme_classic()
wildfires_wells_population %>%
mutate(wildfire_burned_wells = case_when(n_wells >= 1 ~ 1,
n_wells == 0 ~ 0)) %>%
group_by(year) %>%
summarize(n_wildfires = n(),
n_wildfires_with_wells = sum(wildfire_burned_wells)) %>%
mutate(perc_wildfires_with_wells =
round((n_wildfires_with_wells / n_wildfires), digits = 2)) %>%
ggplot(aes(year, perc_wildfires_with_wells)) +
geom_point() +
geom_smooth(method = lm, formula = "y ~ x") +
theme_classic()
wildfires_wells_population %>%
mutate(wildfire_burned_wells = case_when(n_wells >= 1 ~ 1,
n_wells == 0 ~ 0)) %>%
group_by(year) %>%
summarize(n_wildfires = n(),
n_wildfires_with_wells = sum(wildfire_burned_wells)) %>%
mutate(proportion_wildfires_with_wells =
round((n_wildfires_with_wells / n_wildfires), digits = 2)) %>%
ggplot(aes(year, proportion_wildfires_with_wells)) +
geom_point() +
geom_smooth(method = lm, formula = "y ~ x") +
theme_classic()
wildfires_wells_population %>%
mutate(wildfire_burned_wells = case_when(n_wells >= 1 ~ 1,
n_wells == 0 ~ 0)) %>%
group_by(year) %>%
summarize(n_wildfires = n(),
n_wildfires_with_wells = sum(wildfire_burned_wells)) %>%
mutate(proportion_wildfires_with_wells =
round((n_wildfires_with_wells / n_wildfires), digits = 2)) %>%
fitler(proportion_wildfires_with_wells < 0.12) %>%
ggplot(aes(year, proportion_wildfires_with_wells)) +
geom_point() +
geom_smooth(method = lm, formula = "y ~ x") +
theme_classic()
wildfires_wells_population %>%
mutate(wildfire_burned_wells = case_when(n_wells >= 1 ~ 1,
n_wells == 0 ~ 0)) %>%
group_by(year) %>%
summarize(n_wildfires = n(),
n_wildfires_with_wells = sum(wildfire_burned_wells)) %>%
mutate(proportion_wildfires_with_wells =
round((n_wildfires_with_wells / n_wildfires), digits = 2)) %>%
filter(proportion_wildfires_with_wells < 0.12) %>%
ggplot(aes(year, proportion_wildfires_with_wells)) +
geom_point() +
geom_smooth(method = lm, formula = "y ~ x") +
theme_classic()
wildfires_wells_population %>%
mutate(wildfire_burned_wells = case_when(n_wells >= 1 ~ 1,
n_wells == 0 ~ 0)) %>%
group_by(year) %>%
summarize(n_wildfires = n(),
n_wildfires_with_wells = sum(wildfire_burned_wells)) %>%
mutate(proportion_wildfires_with_wells =
round((n_wildfires_with_wells / n_wildfires), digits = 2)) %>%
ggplot(aes(year, proportion_wildfires_with_wells)) +
geom_point() +
geom_smooth(method = lm, formula = "y ~ x") +
theme_classic()
wildfires_wells_population %>%
mutate(wildfire_burned_wells = case_when(n_wells >= 1 ~ 1,
n_wells == 0 ~ 0)) %>%
group_by(year) %>%
summarize(n_wildfires = n(),
n_wildfires_with_wells = sum(wildfire_burned_wells)) %>%
mutate(proportion_wildfires_with_wells =
round((n_wildfires_with_wells / n_wildfires), digits = 2)) %>%
ggplot(aes(year, proportion_wildfires_with_wells)) +
geom_bar(stat = "identity") +
theme_classic()
wildfires_wells_population %>%
mutate(wildfire_burned_wells = case_when(n_wells >= 1 ~ 1,
n_wells == 0 ~ 0)) %>%
group_by(state) %>%
summarize(n_wildfires = n(),
n_wildfires_with_wells = sum(wildfire_burned_wells)) %>%
mutate(proportion_wildfires_with_wells =
round((n_wildfires_with_wells / n_wildfires), digits = 2)) %>%
ggplot(aes(year, proportion_wildfires_with_wells)) +
geom_bar(stat = "identity") +
theme_classic()
wildfires_wells_population %>%
mutate(wildfire_burned_wells = case_when(n_wells >= 1 ~ 1,
n_wells == 0 ~ 0)) %>%
group_by(state) %>%
summarize(n_wildfires = n(),
n_wildfires_with_wells = sum(wildfire_burned_wells)) %>%
mutate(proportion_wildfires_with_wells =
round((n_wildfires_with_wells / n_wildfires), digits = 2)) %>%
ggplot(aes(state, proportion_wildfires_with_wells)) +
geom_bar(stat = "identity") +
theme_classic()
source("code/2-exposure_assessment/05-fxn-assess_expousure_wells_population.R")
source("code/2-exposure_assessment/05-fxn-assess_exposure_wells_population.R")
assessExposurePopulationNearWellsWildfire <-
function(wildfire,
wells,
buffer_dist,
exp_variable) {
# omits wells where the year of the earliest operational date was after the
# year of the wildfire; retains NA dates, too, presumed to pre-date the
# study period given poor record keeping prior to 1980s
wells <- wells %>% filter(year(date_earliest) <= wildfire$year |
is.na(date_earliest))
# generates buffer of given distance around the polygon
wildfire <- wildfire %>% st_buffer(dist = buffer_dist)
# counts wells within the polygon ......................................
wildfire <- wildfire %>%
mutate(!!as.name(exp_variable) :=  # flexibly names the variable on input
sum(unlist(st_intersects(wells, wildfire)))) %>%
as_tibble() %>%
dplyr::select(-geometry)
# returns the processed exposure data ..................................
return(wildfire)
}
assessExposurePopWellsWildfire <-
function(wildfire,
wells,
buffer_dist,
exp_variable) {
# omits wells where the year of the earliest operational date was after the
# year of the wildfire; retains NA dates, too, presumed to pre-date the
# study period given poor record keeping prior to 1980s
wells <- wells %>% filter(year(date_earliest) <= wildfire$year |
is.na(date_earliest))
# generates buffer of given distance around the polygon
wildfire <- wildfire %>% st_buffer(dist = buffer_dist)
# counts wells within the polygon ......................................
wildfire <- wildfire %>%
mutate(!!as.name(exp_variable) :=  # flexibly names the variable on input
sum(unlist(st_intersects(wells, wildfire)))) %>%
as_tibble() %>%
dplyr::select(-geometry)
# returns the processed exposure data ..................................
return(wildfire)
}
assessPopulationWellsWildfire <-
function(wildfire,
wells,
buffer_dist,
exp_variable) {
# omits wells where the year of the earliest operational date was after the
# year of the wildfire; retains NA dates, too, presumed to pre-date the
# study period given poor record keeping prior to 1980s
wells <- wells %>% filter(year(date_earliest) <= wildfire$year |
is.na(date_earliest))
# generates buffer of given distance around the polygon
wildfire <- wildfire %>% st_buffer(dist = buffer_dist)
# counts wells within the polygon ......................................
wildfire <- wildfire %>%
mutate(!!as.name(exp_variable) :=  # flexibly names the variable on input
sum(unlist(st_intersects(wells, wildfire)))) %>%
as_tibble() %>%
dplyr::select(-geometry)
# returns the processed exposure data ..................................
return(wildfire)
}
# attaches functions .....................................................
source("code/0-setup/01-setup.R")
source("code/2-exposure_assessment/05-fxn-assess_exposure_wells_population.R")
library("parallel")   # for the `mclapply()` fxn, if using MacOS
library("lubridate")  # for `Year()` fxn
# data input .............................................................
wildfires_all <- readRDS("data/processed/wildfires_all.rds")
# restricts to wildfires near wells (i.e., intersect with 1 km well buffer)
wildfires_in <- wildfires_all %>%
filter(state == "AZ" & year %in% c(1984:1994)) %>%
st_as_sf() %>%
st_transform(crs_albers) %>%
st_intersection(readRDS("data/interim/wells_buffers/wells_az_buffer_1km.rds"))
# restricts to wells near wildfires (i.e., w/in 1 km of wildfire boundaries)
wells_in <- wells_all %>%
filter(state == "AZ") %>%
st_intersection(
readRDS("data/interim/wildfires_buffers/wildfires_az_buffer_1km.rds")) %>%
st_transform(crs_albers)
# data input .............................................................
wells_all <- readRDS("data/processed/wells_all.rds")
# restricts to wells near wildfires (i.e., w/in 1 km of wildfire boundaries)
wells_in <- wells_all %>%
filter(state == "AZ") %>%
st_intersection(
readRDS("data/interim/wildfires_buffers/wildfires_az_buffer_1km.rds")) %>%
st_transform(crs_albers)
# restricts to wells near wildfires (i.e., w/in 1 km of wildfire boundaries)
wells_in <- wells_all %>%
filter(state == "AZ") %>%
# drops wells drilled after the period
filter(year(date_earliest) <= 1994 | is.na(date_earliest))
# restricts to wells near wildfires (i.e., w/in 1 km of wildfire boundaries)
wells_in <- wells_all %>%
filter(state == "AZ") %>%
# drops wells drilled after the period
filter(year(date_earliest) <= 1994 | is.na(date_earliest)) %>%
st_intersection(
readRDS("data/interim/wildfires_buffers/wildfires_az_buffer_1km.rds")) %>%
st_transform(crs_albers)
# restricts to wildfires near wells for 1984 to 1994
wildfires_in <- wildfires_all %>%
filter(state == "CA" & year %in% c(1984:1994)) %>%
st_as_sf() %>%
st_transform(crs_albers) %>%
st_intersection(readRDS("data/interim/wells_buffers/wells_ca_buffer_1km.rds"))
# restricts to wildfires near wells for 1984 to 1994
wildfires_in <- wildfires_all %>%
filter(state == "NM" & year %in% c(1984:1994)) %>%
st_as_sf() %>%
st_transform(crs_albers) %>%
st_intersection(readRDS("data/interim/wells_buffers/wells_nm_buffer_1km.rds"))
# restricts to wells near wildfires (i.e., w/in 1 km of wildfire boundaries)
wells_in <- wells_all %>%
filter(state == "NM") %>%
# drops wells drilled after the period
filter(year(date_earliest) <= 1994 | is.na(date_earliest)) %>%
st_intersection(
readRDS("data/interim/wildfires_buffers/wildfires_nm_buffer_1km.rds")) %>%
st_transform(crs_albers)
wildfires_in <- split(wildfires_in, seq(1, nrow(wildfires_in))) #converts to list
