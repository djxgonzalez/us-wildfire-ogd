population_1990_mask <-
raster::crop(population_1990, study_region_mask)
# clips population data to states to study region mask
##### next up: troubleshoot why there's no extent in study_region_mask;
##### can I convert the terra object back to raster?
population_1990_mask <-
raster::crop(population_1990, study_region)
1+2
# generates and exports mask of study region using sf package, to import later
study_region <-
st_read("data/raw/esri/USA_States_Generalized.shp") %>%
filter(STATE_ABBR == "CA") %>%
# filter(STATE_ABBR %in%
#          c("OR", "CA", "NV", "AZ", "MT", "WY", "UT", "CO", "NM",
#            "ND", "SD", "NE", "KS", "OK", "TX", "MO", "AR", "LA")) %>%
st_transform(crs_albers)
# attaches packages we need for this script
source("code/0-setup/01-setup.R")
library("raster")
library("terra")
# generates and exports mask of study region using sf package, to import later
study_region <-
st_read("data/raw/esri/USA_States_Generalized.shp") %>%
filter(STATE_ABBR == "CA") %>%
# filter(STATE_ABBR %in%
#          c("OR", "CA", "NV", "AZ", "MT", "WY", "UT", "CO", "NM",
#            "ND", "SD", "NE", "KS", "OK", "TX", "MO", "AR", "LA")) %>%
st_transform(crs_albers)
# reads in gridded population data
pop_1990 <- rast("data/raw/socscape/us_pop1990myc.tif")
pop_1990 <- pop_1990 %>%
raster() %>%
projectRaster(projectExtent(pop_1990, st_crs(crs_albers)))
# clips population data to states to study region mask
##### next up: troubleshoot why there's no extent in study_region_mask;
##### can I convert the terra object back to raster?
pop_1990_cropped <- raster::crop(pop_1990,         study_region)
# generates and exports mask of study region using sf package, to import later
study_region <-
st_read("data/raw/esri/USA_States_Generalized.shp") %>%
filter(STATE_ABBR == "CA") %>%
# filter(STATE_ABBR %in%
#          c("OR", "CA", "NV", "AZ", "MT", "WY", "UT", "CO", "NM",
#            "ND", "SD", "NE", "KS", "OK", "TX", "MO", "AR", "LA")) %>%
st_transform(crs_albers) %>%
as(class = "Spatial")  # convert to sp object
# generates and exports mask of study region using sf package, to import later
study_region <-
st_read("data/raw/esri/USA_States_Generalized.shp") %>%
filter(STATE_ABBR == "CA") %>%
# filter(STATE_ABBR %in%
#          c("OR", "CA", "NV", "AZ", "MT", "WY", "UT", "CO", "NM",
#            "ND", "SD", "NE", "KS", "OK", "TX", "MO", "AR", "LA")) %>%
st_transform(crs_albers) %>%
as(class = "Spatial")  # convert to sp object
# generates and exports mask of study region using sf package, to import later
study_region <-
st_read("data/raw/esri/USA_States_Generalized.shp") %>%
filter(STATE_ABBR == "CA") %>%
# filter(STATE_ABBR %in%
#          c("OR", "CA", "NV", "AZ", "MT", "WY", "UT", "CO", "NM",
#            "ND", "SD", "NE", "KS", "OK", "TX", "MO", "AR", "LA")) %>%
st_transform(crs_albers) %>%
as(Class = "Spatial")  # convert to sp object
study_region
# clips population data to states to study region mask
##### next up: troubleshoot why there's no extent in study_region_mask;
##### can I convert the terra object back to raster?
pop_1990_cropped <- raster::crop(pop_1990,         study_region)
plot(pop_1990_cropped)
##### PICK UP HERE, CONVERT TO SP OBJECT
pop_1990_masked  <- raster::mask(pop_1990_cropped, study_region)
plot(study_region)
pop_1990_cropped
study_region
# clips population data to states to study region mask
##### next up: troubleshoot why there's no extent in study_region_mask;
##### can I convert the terra object back to raster?
pop_1990_cropped <- raster::crop(pop_1990, extent(study_region))
##### PICK UP HERE, CONVERT TO SP OBJECT
pop_1990_masked  <- raster::mask(pop_1990_cropped, study_region)
isS4(pop_1990)
isS4(study_region)
isS4(as.character("34"))
##### PICK UP HERE, CONVERT TO SP OBJECT
pop_1990_masked  <- mask(pop_1990_cropped, study_region)
##### PICK UP HERE, CONVERT TO SP OBJECT
pop_1990_masked  <- mask(study_region, pop_1990_cropped)
pop_1990_cropped
crs_albers
pop_1990 <- pop_1990 %>%
raster() %>%
projectRaster(projectExtent(pop_1990, crs_albers))
pop_1990 <- pop_1990 %>%
raster() %>%
projectRaster(projectExtent(pop_1990, crs(5070)))
crs(5070)
st_crs(study_region)
study_region
pop_1990 <- pop_1990 %>%
raster() %>%
projectRaster(projectExtent(pop_1990, st_crs(study_region)))
# reads in gridded population data
pop_1990 <- rast("data/raw/socscape/us_pop1990myc.tif")
pop_1990 <- pop_1990 %>%
raster() %>%
projectRaster(projectExtent(pop_1990, st_crs(study_region)))
isS4(study_region)
isS4(pop_1990)
st_crs(study_region)
# generates and exports mask of study region using sf package, to import later
study_region <-
st_read("data/raw/esri/USA_States_Generalized.shp") %>%
filter(STATE_ABBR == "CA") %>%
# filter(STATE_ABBR %in%
#          c("OR", "CA", "NV", "AZ", "MT", "WY", "UT", "CO", "NM",
#            "ND", "SD", "NE", "KS", "OK", "TX", "MO", "AR", "LA")) %>%
st_transform(crs_albers) #%>%
# reads in gridded population data
pop_1990 <- rast("data/raw/socscape/us_pop1990myc.tif")
pop_1990 <- pop_1990 %>%
raster() %>%
projectRaster(projectExtent(pop_1990, st_crs(study_region)))
# generates and exports mask of study region using sf package, to import later
study_region <-
st_read("data/raw/esri/USA_States_Generalized.shp") %>%
filter(STATE_ABBR == "CA") %>%
# filter(STATE_ABBR %in%
#          c("OR", "CA", "NV", "AZ", "MT", "WY", "UT", "CO", "NM",
#            "ND", "SD", "NE", "KS", "OK", "TX", "MO", "AR", "LA")) %>%
st_transform(st_crs(5070)) #%>%
# reads in gridded population data
pop_1990 <- rast("data/raw/socscape/us_pop1990myc.tif")
pop_1990 <- pop_1990 %>%
raster() %>%
projectRaster(projectExtent(pop_1990, st_crs(study_region)))
rm(pop_1990)
rm(pop_1990_cropped)
# generates and exports mask of study region using sf package, to import later
study_region <-
st_read("data/raw/esri/USA_States_Generalized.shp") %>%
filter(STATE_ABBR == "CA") %>%
# filter(STATE_ABBR %in%
#          c("OR", "CA", "NV", "AZ", "MT", "WY", "UT", "CO", "NM",
#            "ND", "SD", "NE", "KS", "OK", "TX", "MO", "AR", "LA")) %>%
st_transform(st_crs(5070)) #%>%
# reads in gridded population data
pop_1990 <- rast("data/raw/socscape/us_pop1990myc.tif")
pop_1990 <- pop_1990 %>%
raster() %>%
projectRaster(projectExtent(pop_1990, st_crs(study_region)))
study_region <- study_region %>% as(Class = "Spatial")  # convert to sp object
# clips population data to states to study region mask
##### next up: troubleshoot why there's no extent in study_region_mask;
##### can I convert the terra object back to raster?
pop_1990_cropped <- raster::crop(pop_1990, extent(study_region))
##### PICK UP HERE, CONVERT TO SP OBJECT
pop_1990_masked  <- raster::mask(pop_1990_cropped, study_region)
##### PICK UP HERE, CONVERT TO SP OBJECT
pop_1990_masked  <- raster::mask(pop_1990, study_region)
# reads in gridded population data
pop_1990 <- rast("data/raw/socscape/us_pop1990myc.tif")
rm(pop_1990_cropped)
# clips population data to states to study region mask
##### next up: troubleshoot why there's no extent in study_region_mask;
##### can I convert the terra object back to raster?
pop_1990_cropped <- terra::crop(pop_1990, study_region)
plot(pop_1990_cropped)
pop_1990_masked  <- terra::mask(pop_1990, study_region)
"
# generates and exports mask of study region using sf package, to import later
study_region <-
st_read("data/raw/esri/USA_States_Generalized.shp") %>%
filter(STATE_ABBR == "CA") %>%
# filter(STATE_ABBR %in%
#          c("OR", "CA", "NV", "AZ", "MT", "WY", "UT", "CO", "NM",
#            "ND", "SD", "NE", "KS", "OK", "TX", "MO", "AR", "LA")) %>%
st_transform(st_crs(5070)) #%>%
# generates and exports mask of study region using sf package, to import later
study_region <-
st_read("data/raw/esri/USA_States_Generalized.shp") %>%
filter(STATE_ABBR == "CA") %>%
# filter(STATE_ABBR %in%
#          c("OR", "CA", "NV", "AZ", "MT", "WY", "UT", "CO", "NM",
#            "ND", "SD", "NE", "KS", "OK", "TX", "MO", "AR", "LA")) %>%
st_transform(st_crs(5070)) #%>%
study_region
pop_1990_masked  <- terra::mask(pop_1990, study_region)
# clips population data to states to study region mask
pop_1990_cropped <- terra::crop(pop_1990, study_region)
pop_1990_masked  <- terra::mask(pop_1990, study_region)
pop_1990_masked  <- terra::mask(pop_1990_cropped, study_region)
?terra:mask
?terra::mask
pop_1990_masked  <- terra::mask(pop_1990_cropped, study_region, touches = TRUE)
isS4(pop_1990)
isS4(pop_1990_cropped)
isS4(study_region)
# generates and exports mask of study region using sf package, to import later
study_region <-
st_read("data/raw/esri/USA_States_Generalized.shp") %>%
filter(STATE_ABBR == "CA") %>%
# filter(STATE_ABBR %in%
#          c("OR", "CA", "NV", "AZ", "MT", "WY", "UT", "CO", "NM",
#            "ND", "SD", "NE", "KS", "OK", "TX", "MO", "AR", "LA")) %>%
st_transform(crs_albers) #%>%
isS4(study_region)
isS4(as_Spatial(study_region))
pop_1990_masked  <- terra::mask(pop_1990_cropped,
as_Spatial(study_region),
touches = TRUE)
class(vect(study_region))
pop_1990_masked  <- terra::mask(pop_1990_cropped,
vect(study_region),
touches = TRUE)
pop_1990_masked
plot(pop_1990_masked)
sum(pop_1990_masked)
1+2
values(pop_1990_masked)
# generates and exports mask of study region using sf package, to import later
study_region <-
st_read("data/raw/esri/USA_States_Generalized.shp") %>%
filter(STATE_ABBR == "RI") %>%
# filter(STATE_ABBR %in%
#          c("OR", "CA", "NV", "AZ", "MT", "WY", "UT", "CO", "NM",
#            "ND", "SD", "NE", "KS", "OK", "TX", "MO", "AR", "LA")) %>%
st_transform(crs_albers) #%>%
# reads in gridded population data
pop_1990 <- rast("data/raw/socscape/us_pop1990myc.tif")
# clips population data to states to study region mask
pop_1990_cropped <- terra::crop(pop_1990, study_region)
pop_1990_masked  <- terra::mask(pop_1990_cropped,
vect(study_region),
touches = TRUE)
# generates and exports mask of study region using sf package, to import later
study_region <-
st_read("data/raw/esri/USA_States_Generalized.shp") %>%
filter(STATE_ABBR == "RI") %>%
# filter(STATE_ABBR %in%
#          c("OR", "CA", "NV", "AZ", "MT", "WY", "UT", "CO", "NM",
#            "ND", "SD", "NE", "KS", "OK", "TX", "MO", "AR", "LA")) %>%
st_transform(crs_albers) %>%
vect()
# attaches packages we need for this script
source("code/0-setup/01-setup.R")
library("terra")
# generates and exports mask of study region using sf package, to import later
study_region <-
st_read("data/raw/esri/USA_States_Generalized.shp") %>%
filter(STATE_ABBR == "RI") %>%
# filter(STATE_ABBR %in%
#          c("OR", "CA", "NV", "AZ", "MT", "WY", "UT", "CO", "NM",
#            "ND", "SD", "NE", "KS", "OK", "TX", "MO", "AR", "LA")) %>%
st_transform(crs_albers) %>%
vect()
# generates and exports mask of study region using sf package, to import later
study_region <-
st_read("data/raw/esri/USA_States_Generalized.shp") %>%
filter(STATE_ABBR == "RI") %>%
# filter(STATE_ABBR %in%
#          c("OR", "CA", "NV", "AZ", "MT", "WY", "UT", "CO", "NM",
#            "ND", "SD", "NE", "KS", "OK", "TX", "MO", "AR", "LA")) %>%
st_transform(crs_albers)
# reads in gridded population data
pop_1990 <- rast("data/raw/socscape/us_pop1990myc.tif")
# clips population data to states to study region mask
pop_1990_cropped <- terra::crop(pop_1990, study_region)
# clips population data to states to study region mask
pop_1990_cropped <- terra::crop(pop_1990, vect(study_region))
pop_1990_masked  <- terra::mask(pop_1990_cropped,
vect(study_region),
touches = TRUE)
pop_1990_masked  <- terra::mask(pop_1990,
vect(study_region),
touches = TRUE)
pplot(study_region)
plot(study_region)
n
# generates and exports mask of study region using sf package, to import later
study_region <-
st_read("data/raw/esri/USA_States_Generalized.shp") %>%
filter(STATE_ABBR == "RI") %>%
# filter(STATE_ABBR %in%
#          c("OR", "CA", "NV", "AZ", "MT", "WY", "UT", "CO", "NM",
#            "ND", "SD", "NE", "KS", "OK", "TX", "MO", "AR", "LA")) %>%
st_transform(crs_albers)
# generates and exports mask of study region using sf package, to import later
study_region <-
st_read("data/raw/esri/USA_States_Generalized.shp") %>%
filter(STATE_ABBR == "CO") %>%
# filter(STATE_ABBR %in%
#          c("OR", "CA", "NV", "AZ", "MT", "WY", "UT", "CO", "NM",
#            "ND", "SD", "NE", "KS", "OK", "TX", "MO", "AR", "LA")) %>%
st_transform(crs_albers)
# reads in gridded population data
pop_1990 <- rast("data/raw/socscape/us_pop1990myc.tif")
# pop_1990 <- pop_1990 %>%
# pop_1990 <- pop_1990 %>%
#   raster() %>%
#   projectRaster(projectExtent(pop_1990, st_crs(study_region)))
#study_region <- study_region %>% as(Class = "Spatial")  # convert to sp object
#study_region <- study_region %>% as(Class = "Spatial")  # convert to sp object
# population_2000 <- rast("data/raw/socscape/us_pop2000myc.tif")
# population_2010 <- rast("data/raw/socscape/us_pop2010myc.tif")
## data prep -----------------------------------------------------------------
# clips population data to states to study region mask
pop_1990_cropped <- terra::crop(pop_1990, vect(study_region))
pop_1990_masked  <- terra::mask(pop_1990_cropped,
vect(study_region),
touches = TRUE)
plot(pop_1990_masked)
getValues(pop_1990_masked)
pop_1990_masked
?terra::getValues
d <- pop_1990_masked
1+2
d[1]
d[10000]
d[500]
d2 <- as.data.frame(d)
1+2
d2
d3 <- as_tibble(d2)
d3
d3 %>% drop_na(us_pop1990myc.population_data) %>% nrow()
d4 <- d3 %>% drop_na(us_pop1990myc.population_data)
sum(d4$us_pop1990myc.population_data)
# attaches functions .....................................................
source("code/0-setup/01-setup.R")
source("code/2-assessment/10-fxn-assess_exposure_wells_population.R")
install.packages("geofacet")
# attaches necessary packages
source("code/0-setup/01-setup.R")
library("viridis")
wells_kbdi <- readRDS("data/processed/wells_kbdi.rds")
wells_wildfire_state_year <-
readRDS("data/processed/wells_wildfire_state_year.rds")
wildfires_wells_population <-
readRDS("data/processed/wildfires_wells_population.rds")
# figure 3a ................................................................
# count of oil and gas wells in wildfire burn areas by year
figure_3a <- wells_wildfire_state_year %>%
filter(year %in% c(1984:2019)) %>%
group_by(year) %>%
summarize(n_wells = sum(n_wells),
state   = state) %>%
ggplot(aes(year, n_wells))  +
geom_smooth(method = "lm", formula = y ~ x,
color = "black", lwd = 0.3, linetype = "longdash", alpha = 0.3) +
# geom_smooth(method = "lm", formula = y ~ poly(x, 2),
#             color = "blue", fill = "blue", lwd = 0.3, alpha = 0.3) +
geom_point(size = 0.6) +
labs(x = "", y = "") +
theme_classic() +
theme(axis.line.x  = element_blank(),  # removes x-axis
axis.ticks.x = element_blank(),
axis.text.x  = element_blank(),
axis.text.y  = element_blank(),
legend.position = "none")
figure_3a
# same as above but with geofacet
figure_3a <- wells_wildfire_state_year %>%
filter(year %in% c(1984:2019)) %>%
group_by(year) %>%
summarize(n_wells = sum(n_wells),
state   = state) %>%
ggplot(aes(year, n_wells))  +
geom_smooth(method = "lm", formula = y ~ x,
color = "black", lwd = 0.3, linetype = "longdash", alpha = 0.3) +
# geom_smooth(method = "lm", formula = y ~ poly(x, 2),
#             color = "blue", fill = "blue", lwd = 0.3, alpha = 0.3) +
geom_point(size = 0.6) +
labs(x = "", y = "") +
facet_geo(~ state) +
theme_classic() +
theme(axis.line.x  = element_blank(),  # removes x-axis
axis.ticks.x = element_blank(),
axis.text.x  = element_blank(),
axis.text.y  = element_blank(),
legend.position = "none")
library("geofacet")
library("rgeos")
install.packages("rgeos")
library("geofacet")
library("rgeos")
library("geofacet")
install.packages("rgeos")
remotes::install_github("hafen/geofacet")
library("rgeos")
library("geofacet")
library("geofacet")
library("rgeos")
install.packages("rgeos")
library("ggmap")
citation("ggmap")
# attaches packages ........................................................
source("code/0-setup/01-setup.R")
library("ggspatial")
library("ggmap")
library("lubridate")
# data input ...............................................................
wildfires_all <- readRDS("data/processed/wildfires_all.rds")
wells_all     <- readRDS("data/processed/wells_all.rds")
# Figure 3a - East Amarillo Complex Fire - T - 2006
wildfire_a <- wildfires_all %>%
filter(wildfire_id == "TX3551510078020060312") %>%
st_as_sf() %>%
st_transform(crs_nad83)
# data input ...............................................................
wildfires_all <- readRDS("data/interim/wildfires_all.rds")
wells_all     <- readRDS("data/interim/wells_all.rds")
# Figure 3a - East Amarillo Complex Fire - T - 2006
wildfire_a <- wildfires_all %>%
filter(wildfire_id == "TX3551510078020060312") %>%
st_as_sf() %>%
st_transform(crs_nad83)
wildfire_a_buffer_1km <- wildfire_a %>%
st_buffer(dist = 1000) %>%
st_difference(wildfire_a)
wildfire_a_buffer_40km <- wildfire_a %>%
st_buffer(dist = 40000) %>%
st_difference(wildfire_a)
wells_a <- wells_all %>%
filter(state == "TX") %>%
filter(year(date_earliest) <= wildfire_a$year | is.na(date_earliest)) %>%
st_transform(crs_nad83) %>%
st_intersection(wildfire_a)
wells_a_buffer <- wells_all %>%
filter(state == "TX") %>%
filter(year(date_earliest) <= wildfire_a$year | is.na(date_earliest)) %>%
st_transform(crs_nad83) %>%
st_intersection(wildfire_a_buffer_40km)
# Figure 3b - Loco-Healdton Fire - OK - 2009
wildfire_b <- wildfires_all %>%
filter(wildfire_id == "OK3431309744020090409") %>%
st_as_sf() %>%
st_transform(crs_nad83)
wildfire_b_buffer_1km <- wildfire_b %>%
st_buffer(dist = 1000) %>%
st_difference(wildfire_b)
wildfire_b_buffer_30km <- wildfire_b %>%
st_buffer(dist = 30000) %>%
st_difference(wildfire_b)
wells_b <- wells_all %>%
filter(state == "OK") %>%
filter(year(date_earliest) <= wildfire_b$year | is.na(date_earliest)) %>%
st_transform(crs_nad83) %>%
st_intersection(wildfire_b)
wells_b_buffer <- wells_all %>%
filter(state == "OK") %>%
filter(year(date_earliest) <= wildfire_b$year | is.na(date_earliest)) %>%
st_transform(crs_nad83) %>%
st_intersection(wildfire_b_buffer_30km)
# Figure 3c - Thomas Fire - CA - 2017
wildfire_c <- wildfires_all %>%
filter(wildfire_id == "CA3442911910020171205") %>%
st_as_sf() %>%
st_transform(crs_nad83)
wildfire_c_buffer_1km <- wildfire_c %>%
st_buffer(dist = 1000) %>%
st_difference(wildfire_c)
wildfire_c_buffer_30km <- wildfire_c %>%
st_buffer(dist = 30000) %>%
st_difference(wildfire_c)
wells_c <- wells_all %>%
filter(state == "CA") %>%
filter(year(date_earliest) <= wildfire_c$year | is.na(date_earliest)) %>%
st_transform(crs_nad83) %>%
st_intersection(wildfire_c)
wells_c_buffer <- wells_all %>%
filter(state == "CA") %>%
filter(year(date_earliest) <= wildfire_c$year | is.na(date_earliest)) %>%
st_transform(crs_nad83) %>%
st_intersection(wildfire_c_buffer_30km)
# Figure 3d - Simi Fire - CA - 2003
wildfire_d <- wildfires_all %>%
filter(wildfire_id == "CA3433511879220031025") %>%
st_as_sf() %>%
st_transform(crs_nad83)
wildfire_d_buffer_1km <- wildfire_d %>%
st_buffer(dist = 1000) %>%
st_difference(wildfire_d)
wildfire_d_buffer_30km <- wildfire_d %>%
st_buffer(dist = 30000) %>%
st_difference(wildfire_d)
wells_d <- wells_all %>%
filter(state == "CA") %>%
filter(year(date_earliest) <= wildfire_d$year | is.na(date_earliest)) %>%
st_transform(crs_nad83) %>%
st_intersection(wildfire_d)
wells_d_buffer <- wells_all %>%
filter(state == "CA") %>%
filter(year(date_earliest) <= wildfire_d$year | is.na(date_earliest)) %>%
st_transform(crs_nad83) %>%
st_intersection(wildfire_d_buffer_30km)
# Figure 3a ................................................................
# East Amarillo Complex Fire - CA - 2006 - TX3551510078020060312
figure_3a <- ggplot() +
geom_sf(data = wells_a_buffer, shape = 4, size = 2, color = "gray", alpha = 0.2) +
geom_sf(data = wildfire_a_buffer_1km, fill = "orange", color = NA, alpha = 0.3) +
geom_sf(data = wildfire_a, fill = "red", color = NA, alpha = 0.6) +
geom_sf(data = wells_a, shape = 4, size = 2, alpha = 0.2) +
geom_sf(data = wildfire_a, fill = NA, color = "red") +
annotation_scale(location = "br", width_hint = 0.25) +
annotation_north_arrow(location = "tr", which_north = "true",
style = north_arrow_minimal) +
xlim(-101.5, -100.2) + ylim(35.0, 36.1) +
# theme_void() +
theme(legend.position = "none",
panel.background = element_rect(fill = "white"))
figure_3a
